<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Brainstorm | Cloud-Loader</title>
    <meta name="description" content="Daily AI-generated strategies for building agent services.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¡</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': '#6366f1',
                    }
                }
            }
        }
    </script>
    <style>
        .entry-content { display: none; }
        .entry-content.open { display: block; }
        .entry-toggle .arrow { transition: transform 0.2s; }
        .entry-toggle.open .arrow { transform: rotate(90deg); }
        /* Markdown prose styling */
        .md-content h1 { font-size: 1.5rem; font-weight: 700; margin: 1rem 0 0.5rem; }
        .md-content h2 { font-size: 1.25rem; font-weight: 600; margin: 1rem 0 0.5rem; color: #4338ca; }
        .md-content h3 { font-size: 1.1rem; font-weight: 600; margin: 0.75rem 0 0.25rem; }
        .md-content p { margin: 0.5rem 0; line-height: 1.7; }
        .md-content ul, .md-content ol { margin: 0.5rem 0; padding-left: 1.5rem; }
        .md-content li { margin: 0.25rem 0; }
        .md-content ul li { list-style-type: disc; }
        .md-content ol li { list-style-type: decimal; }
        .md-content code { background: #e5e7eb; padding: 0.1rem 0.35rem; border-radius: 0.25rem; font-size: 0.85em; }
        .md-content pre { background: #1f2937; color: #e5e7eb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 0.75rem 0; }
        .md-content pre code { background: none; padding: 0; color: inherit; }
        .md-content table { border-collapse: collapse; width: 100%; margin: 0.75rem 0; font-size: 0.9em; }
        .md-content th, .md-content td { border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; text-align: left; }
        .md-content th { background: #f3f4f6; font-weight: 600; }
        .md-content strong { font-weight: 600; }
        .md-content hr { border: none; border-top: 1px solid #e5e7eb; margin: 1rem 0; }
        .md-content a { color: #6366f1; text-decoration: underline; }
        .md-content blockquote { border-left: 3px solid #6366f1; padding-left: 1rem; color: #6b7280; margin: 0.75rem 0; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-3xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-brand">ğŸ’¡ Agent Brainstorm</h1>
                    <p class="text-gray-600 mt-1">æ¯æ—¥ AI ç­–ç•¥æ€è€ƒ &mdash; ç”± Claude æ–¼ 20:00 UTC è‡ªå‹•ç”Ÿæˆ</p>
                </div>
                <a href="/human" class="text-sm text-brand hover:underline">&larr; è¿”å›é¦–é </a>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-8">
        <!-- Stats -->
        <div class="mb-6 text-sm text-gray-500">
            å…± {{ total }} ç¯‡ç­–ç•¥{% if total > 0 %} &middot; ç¬¬ {{ page }} / {{ total_pages }} é {% endif %}
        </div>

        {% if entries %}
        <!-- Timeline -->
        <div class="relative">
            <!-- Timeline line -->
            <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-indigo-200"></div>

            <div class="space-y-6">
                {% for entry in entries %}
                <div class="relative pl-10">
                    <!-- Timeline dot -->
                    <div class="absolute left-2.5 top-5 w-3 h-3 bg-brand rounded-full border-2 border-white shadow"></div>

                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <!-- Card header - clickable -->
                        <button onclick="toggleEntry({{ entry.id }})" id="toggle-{{ entry.id }}" class="entry-toggle w-full text-left p-5 hover:bg-gray-50 transition-colors">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-xs font-mono bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded">
                                            {{ entry.created_at.strftime('%Y-%m-%d %H:%M') }} UTC
                                        </span>
                                        <span class="text-xs text-gray-400">{{ entry.concept }}</span>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-900">{{ entry.title }}</h3>
                                    <p class="text-gray-600 text-sm mt-1">{{ entry.summary }}</p>
                                </div>
                                <span class="arrow text-gray-400 ml-3 mt-1 text-lg">&#9654;</span>
                            </div>
                        </button>

                        <!-- Expandable content -->
                        <div id="content-{{ entry.id }}" class="entry-content">
                            <div class="border-t px-5 py-4 bg-gray-50">
                                <div id="md-{{ entry.id }}" class="md-content text-gray-700"></div>
                            </div>
                        </div>
                        <script type="text/markdown" id="raw-{{ entry.id }}">{{ entry.content }}</script>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <nav class="mt-10 flex items-center justify-center gap-2">
            {% if page > 1 %}
            <a href="/agent-brainstorm?page={{ page - 1 }}" class="px-4 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">&larr; ä¸Šä¸€é </a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                <span class="px-4 py-2 text-sm bg-brand text-white rounded-lg font-medium">{{ p }}</span>
                {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                <a href="/agent-brainstorm?page={{ p }}" class="px-4 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">{{ p }}</a>
                {% elif p == page - 3 or p == page + 3 %}
                <span class="px-2 text-gray-400">...</span>
                {% endif %}
            {% endfor %}

            {% if page < total_pages %}
            <a href="/agent-brainstorm?page={{ page + 1 }}" class="px-4 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">ä¸‹ä¸€é  &rarr;</a>
            {% endif %}
        </nav>
        {% endif %}

        {% else %}
        <!-- Empty state -->
        <div class="text-center py-20">
            <div class="text-6xl mb-4">ğŸ§ </div>
            <h2 class="text-xl font-semibold text-gray-700 mb-2">å°šç„¡ç­–ç•¥è¨˜éŒ„</h2>
            <p class="text-gray-500">Worker æœƒåœ¨æ¯å¤© 20:00 UTC è‡ªå‹•ç”¢ç”Ÿæ–°çš„ç­–ç•¥æ€è€ƒã€‚</p>
        </div>
        {% endif %}
    </main>

    <footer class="border-t mt-12">
        <div class="max-w-3xl mx-auto px-4 py-6 text-center text-gray-500 text-sm">
            <p>Powered by Claude + Ralph Loop &middot; <a href="/human" class="text-brand hover:underline">Cloud-Loader</a></p>
        </div>
    </footer>

    <script>
        // Render markdown content with DOMPurify sanitization
        document.querySelectorAll('script[type="text/markdown"]').forEach(function(el) {
            var id = el.id.replace('raw-', '');
            var target = document.getElementById('md-' + id);
            if (target && el.textContent.trim()) {
                var rawHtml = marked.parse(el.textContent);
                var cleanHtml = DOMPurify.sanitize(rawHtml);
                target.insertAdjacentHTML('afterbegin', cleanHtml);
            }
        });

        function toggleEntry(id) {
            var content = document.getElementById('content-' + id);
            var toggle = document.getElementById('toggle-' + id);
            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }
    </script>
</body>
</html>
